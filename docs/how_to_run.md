# Способы запуска скрипта Guido

Этот документ описывает различные методы запуска скрипта "Guido" на целевой Linux-машине. Все команды предполагается выполнять от имени суперпользователя (root).

## 1. Прямой запуск `guido.sh` (для разработки и отладки)

Этот метод используется, когда у вас есть полный каталог `guido_payload/` на машине.

**Подготовка:**
*   Скопируйте весь каталог `guido_payload/` на целевую машину.

**Запуск:**
1.  Перейдите в каталог `guido_payload`:
    ```bash
    cd /путь/к/guido_payload/
    ```
2.  Сделайте основной скрипт исполняемым (если еще не сделано):
    ```bash
    chmod +x guido.sh
    ```
3.  Запустите скрипт с нужными аргументами:
    ```bash
    ./guido.sh
    # или с аргументами:
    ./guido.sh --pretty --sneaky
    ```

## 2. Запуск через `guido_installer.sh` (рекомендуемый способ распространения)

Этот метод использует скрипт-установщик, который содержит все необходимое внутри себя.

**Подготовка:**
*   Соберите `guido_installer.sh` с помощью `build_installer.sh` (см. `how_to_prepare.md`). Файл будет находиться в `build_output/guido_installer.sh`.
*   Скопируйте `build_output/guido_installer.sh` на целевую машину.

**Запуск:**
1.  Сделайте установщик исполняемым:
    ```bash
    chmod +x guido_installer.sh
    ```
2.  Запустите установщик (он передаст аргументы основному скрипту Guido):
    ```bash
    ./guido_installer.sh
    # или с аргументами:
    ./guido_installer.sh --pretty --sneaky
    ```

## 3. Запуск через "Однострочник" (Oneliner)

Этот метод используется для запуска Guido без предварительного копирования каких-либо файлов, передавая все через текстовый поток (например, serial-порт).

### 3.1. Если однострочник передается целиком (короткий)

**Подготовка:**
*   Сгенерируйте файл `guido_installer.oneliner.txt` с помощью `build_installer.sh` (см. `how_to_prepare.md`). Он будет находиться в `build_output/guido_installer.oneliner.txt`.
    *   Если вы использовали опцию `--compressor xz` при сборке, убедитесь, что на целевой машине есть `unxz`.
*   Скопируйте **содержимое** файла `build_output/guido_installer.oneliner.txt`. Обозначим эту длинную строку как `ДЛИННАЯ_BASE64_СТРОКА`.

**Запуск:**
*   Вставьте следующую команду в терминал целевой машины, заменив `ДЛИННАЯ_BASE64_СТРОКА` на вашу реальную строку.

    *   **Если собирали с `gzip` (по умолчанию):**
        ```bash
        echo "ДЛИННАЯ_BASE64_СТРОКА" | base64 -d | gunzip -c | bash
        # или с аргументами для Guido:
        echo "ДЛИННАЯ_BASE64_СТРОКА" | base64 -d | gunzip -c | bash -s -- --pretty --sneaky
        ```

    *   **Если собирали с `xz` (использовали `./build_installer.sh --compressor xz`):**
        ```bash
        echo "ДЛИННАЯ_BASE64_СТРОКА" | base64 -d | unxz -c | bash
        # или с аргументами для Guido:
        echo "ДЛИННАЯ_BASE64_СТРОКА" | base64 -d | unxz -c | bash -s -- --pretty --sneaky
        ```
    *   **Примечание по аргументам:** `bash -s --` позволяет передавать аргументы скрипту, который читается со стандартного ввода. `--` отделяет опции `bash` от опций скрипта.

### 3.2. Если однострочник передается по частям (длинный)

Этот метод используется, если полный однострочник слишком велик для прямой передачи за один раз.

**Подготовка на машине сборки:**
1.  Сгенерируйте однострочник с опцией `--split-oneliner <размер_части_в_байтах>`, например:
    ```bash
    ./build_installer.sh --compressor xz --split-oneliner 42000
    ```
2.  Скрипт `build_installer.sh` создаст файлы частей (например, `oneliner_part_000.xz.b64part`, `oneliner_part_001.xz.b64part`, ...) в каталоге `build_output/`.
3.  Скрипт `build_installer.sh` также выведет **подробные пошаговые инструкции** (ЭТАП 1, ЭТАП 2 для каждой части, ЭТАП 3) для передачи и сборки этих частей на целевой машине.

**Запуск на целевой машине:**

**ВНИМАТЕЛЬНО СЛЕДУЙТЕ ИНСТРУКЦИЯМ, ВЫВЕДЕННЫМ СКРИПТОМ `build_installer.sh`!**
Ниже приведен общий принцип, но точные команды и маркеры могут отличаться.

1.  **ЭТАП 1: Подготовка на ЦЕЛЕВОЙ машине.**
    *   Создайте временный файл, как указано в инструкциях от `build_installer.sh` (обычно с помощью `mktemp` в `/dev/shm` или `/tmp`).
        ```bash
        # Пример из инструкций:
         export TMP_B64_ASSEMBLY_FILE=$(mktemp --tmpdir=/dev/shm guido_payload.XXXXXX.b64 2>/dev/null) || export TMP_B64_ASSEMBLY_FILE=$(mktemp /tmp/guido_payload.XXXXXX.b64)
         echo "Временный файл для сборки: $TMP_B64_ASSEMBLY_FILE"
        ```

2.  **ЭТАП 2: Передача КАЖДОЙ части на ЦЕЛЕВУЮ машину.**
    *   Для каждой части (например, `oneliner_part_000.xz.b64part`, затем `oneliner_part_001.xz.b64part`):
        *   **На машине СБОРКИ:** Просмотрите и скопируйте содержимое файла-части (например, командой `cat build_output/oneliner_part_000.xz.b64part`).
        *   **На ЦЕЛЕВОЙ машине:**
            1.  Введите команду для начала приема многострочного ввода, как указано в инструкциях (например, `cat <<'END_OF_GUIDO_PART' >> "$TMP_B64_ASSEMBLY_FILE"`), и нажмите Enter.
            2.  Сразу после этого вставьте скопированный блок Base64 и нажмите Enter.
            3.  На новой строке введите маркер конца блока (например, `END_OF_GUIDO_PART`) и нажмите Enter.
    *   Повторите эти действия для всех файлов-частей.

3.  **ЭТАП 3: Запуск скрипта и очистка на ЦЕЛЕВОЙ машине.**
    *   После передачи всех частей, выполните команду, предоставленную `build_installer.sh`, для декодирования, распаковки, запуска скрипта Guido и удаления временного файла. Она будет выглядеть примерно так (пример для `xz` и с аргументами для Guido):
        ```bash
        # Пример из инструкций:
         base64 -d "$TMP_B64_ASSEMBLY_FILE" | unxz -c | bash -s -- --pretty --sneaky ; \
           echo 'Скрипт Guido завершен. Удаляю временный файл $TMP_B64_ASSEMBLY_FILE.' ; \
           rm -f "$TMP_B64_ASSEMBLY_FILE"; unset TMP_B64_ASSEMBLY_FILE
        ```

**Важно:** Всегда сверяйтесь с точными командами и маркерами, выведенными скриптом `build_installer.sh` при использовании опции `--split-oneliner`.

---
**Общие рекомендации:**
*   Всегда запускайте скрипты от имени `root`.
*   Для разработки используйте метод 1.
*   Для распространения на машины с доступом к файловой системе используйте метод 2.
*   Для "экстремальных" условий без файлового доступа используйте метод 3 (целиком или по частям).