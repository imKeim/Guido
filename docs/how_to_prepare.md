# Подготовка скрипта Guido к распространению

Этот документ описывает шаги для подготовки скрипта "Guido" и его компонентов к различным способам распространения и запуска. Все артефакты сборки будут помещены в каталог `build_output/`.

## 1. Подготовка "полезной нагрузки" (`guido_payload`)

"Полезная нагрузка" — это каталог `guido_payload/`, содержащий основной скрипт `guido.sh` и все его библиотеки (`core_lib/`, `scenarios/`, `fx_lib/`).

**Когда это нужно:** Каждый раз, когда вы вносите изменения в любой файл внутри `guido_payload/` и хотите создать обновленный установщик или однострочник.

**Шаги:**

1.  **Убедитесь, что все изменения в `guido_payload/` сохранены и протестированы.**
2.  **Используйте скрипт `build_installer.sh` для автоматизации сборки.** Этот скрипт выполнит все необходимые шаги по архивации и кодированию.

## 2. Обновление/Создание `guido_installer.sh` и "Однострочника" (Oneliner)

Скрипт `build_installer.sh` теперь централизованно создает как `guido_installer.sh`, так и файл с "однострочником".

**Когда это нужно:** После внесения изменений в `guido_payload/` или в шаблон `guido_installer.template.sh`.

**Шаги:**

1.  **Убедитесь, что у вас есть актуальные `build_installer.sh` и `guido_installer.template.sh`.**
    *   В `guido_installer.template.sh` плейсхолдер для Base64-строки полезной нагрузки должен быть `PAYLOAD_BASE64="%%PAYLOAD_BASE64_CONTENT%%"`.
2.  **Запустите скрипт сборки:**
    *   Находясь в каталоге, где лежит `build_installer.sh` (например, `DemoExam SysNet Admin/Guido/`), выполните:
        ```bash
        ./build_installer.sh
        ```
    *   **Результат по умолчанию (сжатие `gzip`):**
        *   Готовый `guido_installer.sh` будет создан в `build_output/guido_installer.sh`.
        *   Файл с полным однострочником будет в `build_output/guido_installer.oneliner.txt`.
        *   Команда для запуска однострочника будет выведена в консоль.

3.  **(Опционально) Использование `xz` для лучшего сжатия однострочника:**
    *   Если на целевой машине доступна утилита `unxz` (обычно пакет `xz-utils`), вы можете получить значительно меньший однострочник, используя `xz` для сжатия.
    *   Запустите скрипт сборки с опцией `--compressor xz`:
        ```bash
        ./build_installer.sh --compressor xz
        ```
    *   **Результат:**
        *   `build_output/guido_installer.sh` будет таким же.
        *   `build_output/guido_installer.oneliner.txt` будет содержать Base64 от `xz`-сжатого установщика.
        *   Команда для запуска однострочника будет адаптирована под `unxz`.
    *   **Важно:** Убедитесь, что `xz` установлен на машине, где вы запускаете `build_installer.sh`, и `unxz` — на целевой машине.

4.  **(Опционально) Разбиение длинного однострочника на части:**
    *   Если сгенерированный однострочник (даже с `xz`) слишком велик для передачи целиком (например, через serial-порт), вы можете указать скрипту `build_installer.sh` разбить его на части.
    *   Используйте опцию `--split-oneliner <размер_части_в_байтах>`. Например, для частей по 2 КБ:
        ```bash
        ./build_installer.sh --compressor xz --split-oneliner 2048
        ```
    *   **Результат:**
        *   Файл `build_output/guido_installer.oneliner.txt` все равно будет содержать полный однострочник.
        *   Дополнительно в каталоге `build_output/` будут созданы файлы частей (например, `oneliner_part_000.xz.b64part`, `oneliner_part_001.xz.b64part`, ...).
        *   Скрипт `build_installer.sh` выведет в консоль **подробные пошаговые инструкции** по передаче этих частей на целевую машину и их последующей сборке и запуску. **Внимательно следуйте этим инструкциям!**

**Структура каталога `build_output/` после запуска `build_installer.sh`:**
*   `guido_installer.sh` (готовый к использованию установщик)
*   `guido_installer.oneliner.txt` (содержит полную Base64-строку для однострочного запуска)
*   `oneliner_part_*` (файлы частей, если использовалась опция `--split-oneliner`)

**Удаление временных файлов:** Скрипт `build_installer.sh` автоматически удаляет промежуточные файлы (например, `guido_payload.tar.gz`, `guido_payload_base64.txt`, сжатый установщик) из каталога `build_output/` после их использования.